<!DOCTYPE html>
<html lang="ja" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>そうだ Hugo の最新版を使おう！ &middot; </title>
  <meta name="description" content="そんなときは大体ハマる。" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <link href="https://k-kaz-git.github.io/css/katex.css" rel="stylesheet">
  
  
  
  
  <link href="https://k-kaz-git.github.io/css/concated.min.css" rel="stylesheet">

  
  <link rel="stylesheet" href="https://k-kaz-git.github.io/sass/main.fcdea0c4becd73f2e3b2312b85bcd7ba626d441c1cde1e1b8046a6afcc4e22b8.css">

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-134722453-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
  
</head>
  <body class="single-body">
    <nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="https://k-kaz-git.github.io/" class="nav-text">k-kaz が Hugo で遊ぶサイト</a></h1>
  <div class="hamburger-menu">
    <button onclick="hamburgerMenuPressed.call(this)" aria-haspopup="true" aria-expanded="false" aria-controls="menu" aria-label="Menu">
      <span></span>
      <span></span>
    </button>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="https://k-kaz-git.github.io/" class="hamburger-menu-overlay-link">Home</a></li>
      <li class="navi-menu">- Categories -</li>
      <li style="font-size: 0.7em;"><a href="https://k-kaz-git.github.io/categories/coding" class="hamburger-menu-overlay-link">Coding</a></li><li style="font-size: 0.7em;"><a href="https://k-kaz-git.github.io/categories/homepage" class="hamburger-menu-overlay-link">Homepage</a></li><li style="font-size: 0.7em;"><a href="https://k-kaz-git.github.io/categories/linux" class="hamburger-menu-overlay-link">Linux</a></li>
      <li class="navi-menu">- Tags -</li>
      <li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/aether" class="hamburger-menu-overlay-link">Aether</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/categories" class="hamburger-menu-overlay-link">Categories</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/css" class="hamburger-menu-overlay-link">Css</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/cupper" class="hamburger-menu-overlay-link">Cupper</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/favicon" class="hamburger-menu-overlay-link">Favicon</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/github" class="hamburger-menu-overlay-link">Github</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/hugo" class="hamburger-menu-overlay-link">Hugo</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/markdown" class="hamburger-menu-overlay-link">Markdown</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/mozc" class="hamburger-menu-overlay-link">Mozc</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/netlify" class="hamburger-menu-overlay-link">Netlify</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/pagermod" class="hamburger-menu-overlay-link">Pagermod</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/saas" class="hamburger-menu-overlay-link">Saas</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/sass" class="hamburger-menu-overlay-link">Sass</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/shortcodes" class="hamburger-menu-overlay-link">Shortcodes</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/snippet" class="hamburger-menu-overlay-link">Snippet</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/stylesheet" class="hamburger-menu-overlay-link">Stylesheet</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/svg" class="hamburger-menu-overlay-link">Svg</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/tableofcontents" class="hamburger-menu-overlay-link">Tableofcontents</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/tags" class="hamburger-menu-overlay-link">Tags</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/theme" class="hamburger-menu-overlay-link">Theme</a></li><li style="font-size: 0.5em;"><a href="https://k-kaz-git.github.io/tags/vscode" class="hamburger-menu-overlay-link">Vscode</a></li>
    </ul>
  </div>
</nav>
    <main class="content side-text-padding">
      <article class="post ">
        <header class="post-header">
        	<h1 class="post-title">そうだ Hugo の最新版を使おう！</h1>
          <p class="post-date">
            Posted <time datetime="2020-10-18">2020-10-18</time>
             / Update 2020-10-28</p>
             <div class="card-subtext muted-text li-line">
               <a class="cat" href="/categories/coding">coding</a>
               <a class="tag" href="/tags/hugo">#hugo</a> 
             </div>
        </header>
        
        <picture class="post-figure">
            <source srcset="https://k-kaz-git.github.io/images/man-1394395_1920.webp" type="image/webp">
            <source srcset="https://k-kaz-git.github.io/images/man-1394395_1920.webp">
          <img src="https://k-kaz-git.github.io/images/man-1394395_1920.webp" alt="孤独な考える人">
        </picture>
        
        <aside>
          <h2>目次</h2>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#hugo-ってバージョンアップしてるの">Hugo ってバージョンアップしてるの？</a></li>
    <li><a href="#最新版にするにはwindows">最新版にするには（Windows）</a></li>
    <li><a href="#チェックしましょう">チェックしましょう。</a></li>
    <li><a href="#修正します">修正します。</a></li>
    <li><a href="#あれ-レイアウトが">あれ？ レイアウトが・・・</a></li>
    <li><a href="#調査開始">調査開始</a>
      <ul>
        <li><a href="#まずは定番">まずは定番</a></li>
        <li><a href="#地道に仕様変更を探る">地道に仕様変更を探る</a></li>
        <li><a href="#あれ引用がごっそり消えている">あれ、引用がごっそり消えている</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </aside>
        <h2 id="hugo-ってバージョンアップしてるの">Hugo ってバージョンアップしてるの？</h2>
<p>まずは、私が使っている現在のバージョンを確認。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>$ hugo version
</span></span><span style="display:flex;"><span>$ Hugo Static Site Generator v0.54.0/extended windows/amd64 BuildDate: unknown
</span></span></code></pre></div><p>ふむ、0.54 を使っているらしい。</p>
<p>公式サイトに行ってみると、0.76.5 が最新の様子。<br>
<strong>すっかり時代に取り残されていました。</strong></p>
<h2 id="最新版にするにはwindows">最新版にするには（Windows）</h2>
<p>Windows の場合は、GitHub から Zip を落としてきて、実行ファイルを入れ替えるだけで完了です。</p>
<h2 id="チェックしましょう">チェックしましょう。</h2>
<p>とりあえず今までの記事が正常に見られるかチェック。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>$ hugo server -D
</span></span><span style="display:flex;"><span>Start building sites …
</span></span><span style="display:flex;"><span>WARN 2020/10/16 15:08:48 Page.RSSLink is deprecated and will be removed in a future release. Use the Output Format&#39;s link, e.g. something like:
</span></span><span style="display:flex;"><span>    {{ with .OutputFormats.Get &#34;RSS&#34; }}{{ .RelPermalink }}{{ end }}
</span></span></code></pre></div><p>なんか怒られた。</p>
<h2 id="修正します">修正します。</h2>
<p>調べてみたら、<code>.RSSLink</code> っていうのが最新版では使えないっていうことらしい。</p>
<p><code>head.html</code> で使っていたので修正しました。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>{{ if .RSSLink }}
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ .RSSLink }}&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;alternate&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;application/rss+xml&#34;</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ .Title }}&#34;</span> /&gt;{{ end }}
</span></span></code></pre></div><p>↓ こんな風に。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>{{ with .OutputFormats.Get &#34;RSS&#34; }}
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ .RelPermalink }}&#34;</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;alternate&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;application/rss+xml&#34;</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ $.Site.Title }}&#34;</span> /&gt;{{ end }}
</span></span></code></pre></div><p>これでエラーは出なくなった。</p>
<h2 id="あれ-レイアウトが">あれ？ レイアウトが・・・</h2>
<p>トップページのレイアウトがおかしい。<br>
今までは <code>content/post/</code> 以下の記事がずらっと並んでくれたんですが、<code>content</code> が表示されてるっぽい。</p>
<p><img src="/images/hugo-newversion-01.webp" alt="トップページのレイアウトがおかしいのイメージ画像"></p>
<p>画面に出ている <code>post</code> をクリックして開くといつもの感じになるけど、仕様が変わったのかな・・・。</p>
<h2 id="調査開始">調査開始</h2>
<h3 id="まずは定番">まずは定番</h3>
<p>Google でいろいろ調べました。</p>
<p><strong>まったく分からんかったけどね。</strong></p>
<p>Permalink の設定でなんとかならんもんかと四苦八苦するものの駄目でした。</p>
<h3 id="地道に仕様変更を探る">地道に仕様変更を探る</h3>
<p>どのバージョンからレイアウトが崩れているのか、GitHub から過去バージョンを落としまくって調査しました。</p>
<p>v0.60.0 NG<br>
v0.57.0 NG  ← <strong>お前か！</strong><br>
v0.56.0 OK<br>
v0.56.3 OK</p>
<p>リリース情報の中身を念入りチェックしていたら、気になる一文を発見。</p>
<blockquote>
    <p>
home.Pages now only returns pages in the top level section. Before this release, it included all regular pages in the site. This made it easy to list all the pages on home page, but it also meant that you needed to take special care if you wanted to navigate the page tree from top to bottom. If you need all regular pages, use .Site.RegularPages. 
</p><br>
    <cite><a class="author" href="https://github.com/gohugoio/hugo/releases/tag/v0.57.0">GitHub</a></cite>
</blockquote>
<p>英語読めないので、翻訳しました。</p>
<blockquote>
    <p>
home.Pagesはトップレベルセクションのページのみを返すようになりました。
このリリースの前は、サイト内のすべての通常のページが含まれていました。
これにより、ホームページ上のすべてのページを簡単にリストアップすることができましたが、
ページツリーを上から下に移動したい場合には、特別な注意が必要なことも意味していました。
すべてのレギュラーページが必要な場合は、.Site.RegularPagesを使用してください。
</p><br>
    <cite><a class="author" href="https://github.com/gohugoio/hugo/releases/tag/v0.57.0">GitHub</a></cite>
</blockquote>
<p>これだ。</p>
<p><code>\themes\xxxx\layouts\_default\list.html</code> の中に <code>.Pages</code> を使っていたので、そこを <code>.Site.RegularPages</code> に直すことで解決しました。</p>
<p>半日近くかかったよ。</p>
<h3 id="あれ引用がごっそり消えている">あれ、引用がごっそり消えている</h3>
<p>たまたま気付いたんですが、引用した部分がごっそり消えていたんですよ。</p>
<p>html のソースを見ると、その部分が</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- raw HTML omitted --&gt;</span>
</span></span></code></pre></div><p>となっていました。</p>
<p>これは Google ですぐに見付けました。</p>
<p>v0.60.0 から、記事ファイル（hoge.md）に書かれた html が表示されなくなったとのこと。（なんで？）</p>
<p>解決策は <code>config.toml</code> にオプションを追加すればオッケー。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>[<span style="color:#a6e22e">markup</span>.<span style="color:#a6e22e">goldmark</span>.<span style="color:#a6e22e">renderer</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">unsafe</span>= <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><p>すぐ直って良かった。</p>
<p>ということで、今回から最新版の Hugo を使っていきます。</p>

      </article>
      <hr>
      <p class="post-date">
        Posted <time datetime="2020-10-18">2020-10-18</time>
         / Update 2020-10-28</p>
         <div class="card-subtext muted-text li-line">
           <a class="cat" href="/categories/coding">coding</a>
           <a class="tag" href="/tags/hugo">#hugo</a> 
         </div>
    </main>
    <nav class="end-nav side-padding">
      
      <a ontouchstart="cardPressed.call(this)" ontouchend="cardReleased.call(this)" ontouchmove="cardReleased.call(this)" 
  href="https://k-kaz-git.github.io/post/hugo-deploy-error/" class="card blog-card" rel="bookmark" >
    
    <div class="card-img-container">
      <p class="card-img-overlay">Next Article</p>
      <picture>
        <source srcset="https://k-kaz-git.github.io/images/hugo-deploy-error.webp" type="image/webp">
        <source srcset="https://k-kaz-git.github.io/images/hugo-deploy-error.webp">
        <img src="https://k-kaz-git.github.io/images/hugo-deploy-error.webp" class="card-img" alt="厳重な扉">
      </picture>
    </div>
    
  <article class="card-body">
    <h2 class="card-title">Deploy でエラーが出たんですけど。</h2>
    <p class="card-text">1年半振りの Deploy で・・・。</p>
    <div class="card-subtext muted-text">
      <p>Posted <time datetime="2020-10-14">2020-10-14</time>
      / Updated 2020-10-19</p>
    </div>
    <div class="card-subtext muted-text li-line">
      <span class="box-gray">homepage</span> 
      <span class="box-gray">#hugo</span> <span class="box-gray">#github</span> <span class="box-gray">#Netlify</span> 
    </div>
  </article>
</a>
      
      <a ontouchstart="cardPressed.call(this)" ontouchend="cardReleased.call(this)" ontouchmove="cardReleased.call(this)" 
  href="https://k-kaz-git.github.io/" class="card home-card" style="background-image: url( https://k-kaz-git.github.io/img/grey-cloud.jpg )" rel="bookmark" >
  Home
</a>
    </nav>
    <footer>
    <p style="text-align: center">姉妹サイト<br><a class="btn-link" href="https://k-kaz.net/" target="_blank">k-kaz ブログ</a></p>
</footer>
    
  <script defer src="https://k-kaz-git.github.io/js/katex.js"></script>


  <script defer src="https://k-kaz-git.github.io/js/auto-render.js" onload="renderMathInElement(document.body);"></script>


<script src="https://k-kaz-git.github.io/js/core.min.js"></script>

  </body>
</html>